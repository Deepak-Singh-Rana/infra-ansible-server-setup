##############################
# DO NOT MANUALLY EDIT
# ANY CHANGES WILL BE OVER WRITTEN WHEN THE PACKAGE GETS UPDATED
# The file has a zz prefix to allow it to load last
##############################


# CIS Hardening configuration file
#
# This file is here to enable a Apache server level hardening custom configurations to secure the server to the level of the CIS hardening baseline.
# The most restrictive setting is enabled at the server level context with less restrictive settings enabled at the virtual host context.
# Please do not edit this file to enable virtual hostlevel configuration, open the restriction with directives at the virtual_host config.
# All hardening configuration for the Apache service can be added/configured in this file with the exception of file permissions and the listenng directive in ports.conf.


# CIS hardening requirement limit Html options hardenign CIS requirement 5.7
<Directory "/var/virtual-hosts/">
        # Limit HTTP methods to standard methods. Note: Does not limit TRACE
        <LimitExcept GET POST OPTIONS>
        Require all denied
        </LimitExcept>
</Directory>


# CIS hardening requirement 5.8 Disable HTTP TRACE Method (Scored)
TraceEnable Off

# CIS hardening requirement 5.9 Restrict HTTP Protocol Versions (Scored)

RewriteEngine On
RewriteCond %{THE_REQUEST} !HTTP/1\.1$
RewriteRule .* - [F]
RewriteOptions InheritDownBefore

# CIS hardening requirement 5.11 Restrict File Extensions (Scored)
# Block all files by default, unless specifically allowed.

<FilesMatch "^.*$">
Require all denied
</FilesMatch>

# CIS Hardening 5.13 Restrict Listen Directive (Scored)
# Listening directive added to ports.conf

# CIS Hardening requirement 5.14 Restrict Browser Frame Options (Scored)
Header always set Content-Security-Policy "default-src https: data: 'unsafe-inline' 'unsafe-eval'"
Header always set Referrer-Policy: strict-origin-when-cross-origin
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-Content-Type-Options "nosniff"
Header always set X-Xss-Protection "1; mode=block"


# CIS Requirement 6.1 Configure the Error Log (Scored)
LogLevel notice core:info

#CIS hardening requirement 7.5 Restrict Weak SSL Ciphers (Scored)
SSLCipherSuite ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS

# CIS hardening requirement 7.6 Set SSLInsecureRenegotiation off at server level
SSLInsecureRenegotiation off

#CIS hardening requirement 7.7 Ensure SSL Compression is not Enabled (Scored)
SSLCompression Off

#CIS Hardening requirement 7.8 Disable the TLS v1.0 Protocol (Scored)
SSLProtocol -all +TLSv1.2

# CIS hardening requirement 7.9 Enable OCSP Stapling (Scored)
SSLUseStapling on
SSLStaplingCache shmcb:logs/ssl_staple_cache(512000)

# CIS hardening requirement 8.1 Set ServerToken to 'Prod' (Scored)
ServerTokens Prod

# CIS hardening requirement 8.1 Set ServerSignature to 'Off' (Scored)
ServerSignature Off
SSLHonorCipherOrder On

# CIS hardening requirement 9.1 Set TimeOut to 10 or less (Scored)
Timeout 30

# CIS hardening requirement 10.1 Set the LimitRequestLine directive to 512 or less (Scored)
LimitRequestline 512

# CIS hardening requirement 10.2 Set the LimitRequestFields directive to 100 or less (Scored)
LimitRequestFields 100

# CIS hardening requirment 10.3 Set the LimitRequestFieldsize directive to 1024 or less (Scored)
LimitRequestFieldsize 1024

# CIS hardening requirement 10.4 Set the LimitRequestBody directive to 102400 or less (Scored)
LimitRequestBody 102400


#misc
<Directory /usr/share>
        AllowOverride None
        Require all denied
</Directory>

<Directory /var/www/>
        Options None
        AllowOverride None
        Require all denied
</Directory>
